<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Document Exchange System - CMPS 380</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üîê Secure Document Exchange System</h1>
            <p class="subtitle">Visual Demonstration of Hybrid Cryptography (RSA-OAEP + AES-GCM + RSA-PSS)</p>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Step 0: Initial Setup -->
            <section id="step-0" class="step-section active">
                <div class="parties-container">
                    <!-- Alice -->
                    <div class="party alice-party">
                        <div class="party-header">
                            <img src="{{ url_for('static', filename='alice-image.jpg') }}" alt="Alice" class="party-avatar">
                            <h2>Alice</h2>
                        </div>
                        <div class="party-status">
                            <span class="status-badge">Ready</span>
                        </div>
                        <div class="party-info">
                            <h3>Files Available:</h3>
                            <div class="file-list" id="alice-files">
                                <div class="file-item" data-filename="sample_1kb.txt" data-size="1024" data-owner="alice">
                                    <span class="file-icon">üìÑ</span>
                                    <span class="file-name">sample_1kb.txt</span>
                                    <span class="file-size">1 KB</span>
                                </div>
                                <div class="file-item" data-filename="document_1mb.pdf" data-size="1048576" data-owner="alice">
                                    <span class="file-icon">üìÑ</span>
                                    <span class="file-name">document_1mb.pdf</span>
                                    <span class="file-size">1 MB</span>
                                </div>
                                <div class="file-item" data-filename="video_10mb.mp4" data-size="10485760" data-owner="alice">
                                    <span class="file-icon">üé•</span>
                                    <span class="file-name">video_10mb.mp4</span>
                                    <span class="file-size">10 MB</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Transfer Direction Selector -->
                    <div class="transfer-selector">
                        <h3>Select Transfer Direction</h3>
                        <div class="direction-options">
                            <label class="direction-option">
                                <input type="radio" name="direction" value="alice-to-bob" checked>
                                <span class="direction-label">Alice ‚Üí Bob</span>
                            </label>
                            <label class="direction-option">
                                <input type="radio" name="direction" value="bob-to-alice">
                                <span class="direction-label">Bob ‚Üí Alice</span>
                            </label>
                        </div>
                        
                        <div class="custom-file-upload">
                            <h3>Or Upload Custom File</h3>
                            <input type="file" id="custom-file" accept="*/*">
                            <label for="custom-file" class="file-upload-btn">üìÅ Choose File</label>
                            <span id="custom-file-name"></span>
                        </div>

                        <button id="start-btn" class="primary-btn">‚ñ∂ Start Transfer</button>
                    </div>

                    <!-- Bob -->
                    <div class="party bob-party">
                        <div class="party-header">
                            <img src="{{ url_for('static', filename='bob-image.jpg') }}" alt="Bob" class="party-avatar">
                            <h2>Bob</h2>
                        </div>
                        <div class="party-status">
                            <span class="status-badge">Ready</span>
                        </div>
                        <div class="party-info">
                            <h3>Files Available:</h3>
                            <div class="file-list" id="bob-files">
                                <div class="file-item" data-filename="report_1kb.pdf" data-size="1024" data-owner="bob">
                                    <span class="file-icon">üìÑ</span>
                                    <span class="file-name">report_1kb.pdf</span>
                                    <span class="file-size">1 KB</span>
                                </div>
                                <div class="file-item" data-filename="data_1mb.json" data-size="1048576" data-owner="bob">
                                    <span class="file-icon">üìä</span>
                                    <span class="file-name">data_1mb.json</span>
                                    <span class="file-size">1 MB</span>
                                </div>
                                <div class="file-item" data-filename="archive_10mb.zip" data-size="10485760" data-owner="bob">
                                    <span class="file-icon">üóúÔ∏è</span>
                                    <span class="file-name">archive_10mb.zip</span>
                                    <span class="file-size">10 MB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 1: Generate Keys -->
            <section id="step-1" class="step-section">
                <div class="step-header">
                    <h2>Step 1: Generate RSA Keypairs</h2>
                    <p>Both Alice and Bob generate two RSA-2048 keypairs each: one for signing (identity) and one for encryption</p>
                </div>
                <div class="key-generation-container">
                    <div class="key-gen-party">
                        <div class="party-header-with-avatar">
                            <img src="{{ url_for('static', filename='alice-image.jpg') }}" alt="Alice" class="party-avatar-small">
                            <h3>Alice's Keys</h3>
                        </div>
                        <div class="key-display">
                            <div class="key-box">
                                <h4>üîë Signing Keypair (RSA-PSS)</h4>
                                <p class="key-purpose">Used for creating digital signatures</p>
                                <div class="key-pair-container">
                                    <div class="key-item">
                                        <span class="key-label">üîì Public Key</span>
                                        <div class="key-animation public-key" id="alice-signing-key-public"></div>
                                    </div>
                                    <div class="key-item">
                                        <span class="key-label">üîí Private Key <span class="toggle-hint">(click to reveal)</span></span>
                                        <div class="key-animation private-key hidden" id="alice-signing-key-private" onclick="toggleKeyVisibility(this)"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="key-box">
                                <h4>üîê Encryption Keypair (RSA-OAEP)</h4>
                                <p class="key-purpose">Used for key wrapping</p>
                                <div class="key-pair-container">
                                    <div class="key-item">
                                        <span class="key-label">üîì Public Key</span>
                                        <div class="key-animation public-key" id="alice-encryption-key-public"></div>
                                    </div>
                                    <div class="key-item">
                                        <span class="key-label">üîí Private Key <span class="toggle-hint">(click to reveal)</span></span>
                                        <div class="key-animation private-key hidden" id="alice-encryption-key-private" onclick="toggleKeyVisibility(this)"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="key-gen-party">
                        <div class="party-header-with-avatar">
                            <img src="{{ url_for('static', filename='bob-image.jpg') }}" alt="Bob" class="party-avatar-small">
                            <h3>Bob's Keys</h3>
                        </div>
                        <div class="key-display">
                            <div class="key-box">
                                <h4>üîë Signing Keypair (RSA-PSS)</h4>
                                <p class="key-purpose">Used for creating digital signatures</p>
                                <div class="key-pair-container">
                                    <div class="key-item">
                                        <span class="key-label">üîì Public Key</span>
                                        <div class="key-animation public-key" id="bob-signing-key-public"></div>
                                    </div>
                                    <div class="key-item">
                                        <span class="key-label">üîí Private Key <span class="toggle-hint">(click to reveal)</span></span>
                                        <div class="key-animation private-key hidden" id="bob-signing-key-private" onclick="toggleKeyVisibility(this)"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="key-box">
                                <h4>üîê Encryption Keypair (RSA-OAEP)</h4>
                                <p class="key-purpose">Used for key wrapping</p>
                                <div class="key-pair-container">
                                    <div class="key-item">
                                        <span class="key-label">üîì Public Key</span>
                                        <div class="key-animation public-key" id="bob-encryption-key-public"></div>
                                    </div>
                                    <div class="key-item">
                                        <span class="key-label">üîí Private Key <span class="toggle-hint">(click to reveal)</span></span>
                                        <div class="key-animation private-key hidden" id="bob-encryption-key-private" onclick="toggleKeyVisibility(this)"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 2: Key Exchange & Binding -->
            <section id="step-2" class="step-section">
                <div class="step-header">
                    <h2>Step 2: Exchange & Bind Public Keys</h2>
                    <p>Each party binds their encryption public key to their identity using digital signatures to prevent MITM attacks</p>
                </div>
                
                <div class="key-exchange-container-v2">
                    <!-- Alice's Binding Process -->
                    <div class="binding-process">
                        <div class="party-header-with-avatar">
                            <img src="{{ url_for('static', filename='alice-image.jpg') }}" alt="Alice" class="party-avatar-small">
                            <h3>Alice's Key Binding</h3>
                        </div>
                        
                        <div class="binding-visualization">
                            <!-- Step 1: Take Public Key -->
                            <div class="binding-step visible-stage" data-stage="0">
                                <div class="step-icon">üîì</div>
                                <h4>Encryption Public Key</h4>
                                <div class="key-preview" id="alice-pub-key-preview">
                                    <code>-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
-----END PUBLIC KEY-----</code>
                                </div>
                            </div>
                            
                            <!-- Step 2: Hash It -->
                            <div class="binding-step highlighted" data-stage="1">
                                <div class="step-icon">üî¢</div>
                                <h4>Apply SHA-256 Hash Function</h4>
                                <div class="hash-visualization">
                                    <div class="hash-input">Public Key (2048 bits)</div>
                                    <div class="hash-arrow">‚Üí SHA-256 ‚Üí</div>
                                    <div class="hash-output" id="alice-key-hash-visual">Hash (256 bits)</div>
                                </div>
                                <div class="hash-result" id="alice-key-hash"></div>
                            </div>
                            
                            <!-- Step 3: Sign It -->
                            <div class="binding-step highlighted" data-stage="2">
                                <div class="step-icon">‚úçÔ∏è</div>
                                <h4>Sign with Private Signing Key (RSA-PSS)</h4>
                                <div class="signing-visualization">
                                    <div class="sign-process">
                                        <div class="sign-input-box">
                                            <span class="sign-label">Hash</span>
                                            <span class="plus-sign">+</span>
                                            <span class="sign-label">üîí Private Key</span>
                                        </div>
                                        <div class="sign-arrow">‚Üí</div>
                                        <div class="sign-output-box">
                                            <span class="sign-label">Digital Signature</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="signature-result" id="alice-signature"></div>
                            </div>
                            
                            <!-- Final Package -->
                            <div class="binding-step success" data-stage="3">
                                <div class="step-icon">üì¶</div>
                                <h4>Signed Public Key Package</h4>
                                <div class="package-contents">
                                    <div class="package-item">
                                        <span class="package-icon">üîì</span>
                                        <span>Encryption Public Key</span>
                                    </div>
                                    <div class="package-item">
                                        <span class="package-icon">‚úçÔ∏è</span>
                                        <span>Digital Signature</span>
                                    </div>
                                </div>
                                <p class="package-note">Ready to send to Bob!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Exchange Arrow -->
                    <div class="exchange-center">
                        <div class="exchange-arrow-static">
                            <div class="arrow-line"></div>
                            <span class="exchange-icon">‚áÑ</span>
                            <div class="exchange-label">Secure Exchange</div>
                        </div>
                    </div>
                    
                    <!-- Bob's Binding Process -->
                    <div class="binding-process">
                        <div class="party-header-with-avatar">
                            <img src="{{ url_for('static', filename='bob-image.jpg') }}" alt="Bob" class="party-avatar-small">
                            <h3>Bob's Key Binding</h3>
                        </div>
                        
                        <div class="binding-visualization">
                            <!-- Step 1: Take Public Key -->
                            <div class="binding-step visible-stage" data-stage="0">
                                <div class="step-icon">üîì</div>
                                <h4>Encryption Public Key</h4>
                                <div class="key-preview" id="bob-pub-key-preview">
                                    <code>-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
-----END PUBLIC KEY-----</code>
                                </div>
                            </div>
                            
                            <!-- Step 2: Hash It -->
                            <div class="binding-step highlighted" data-stage="1">
                                <div class="step-icon">üî¢</div>
                                <h4>Apply SHA-256 Hash Function</h4>
                                <div class="hash-visualization">
                                    <div class="hash-input">Public Key (2048 bits)</div>
                                    <div class="hash-arrow">‚Üí SHA-256 ‚Üí</div>
                                    <div class="hash-output" id="bob-key-hash-visual">Hash (256 bits)</div>
                                </div>
                                <div class="hash-result" id="bob-key-hash"></div>
                            </div>
                            
                            <!-- Step 3: Sign It -->
                            <div class="binding-step highlighted" data-stage="2">
                                <div class="step-icon">‚úçÔ∏è</div>
                                <h4>Sign with Private Signing Key (RSA-PSS)</h4>
                                <div class="signing-visualization">
                                    <div class="sign-process">
                                        <div class="sign-input-box">
                                            <span class="sign-label">Hash</span>
                                            <span class="plus-sign">+</span>
                                            <span class="sign-label">üîí Private Key</span>
                                        </div>
                                        <div class="sign-arrow">‚Üí</div>
                                        <div class="sign-output-box">
                                            <span class="sign-label">Digital Signature</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="signature-result" id="bob-signature"></div>
                            </div>
                            
                            <!-- Final Package -->
                            <div class="binding-step success" data-stage="3">
                                <div class="step-icon">üì¶</div>
                                <h4>Signed Public Key Package</h4>
                                <div class="package-contents">
                                    <div class="package-item">
                                        <span class="package-icon">üîì</span>
                                        <span>Encryption Public Key</span>
                                    </div>
                                    <div class="package-item">
                                        <span class="package-icon">‚úçÔ∏è</span>
                                        <span>Digital Signature</span>
                                    </div>
                                </div>
                                <p class="package-note">Ready to send to Alice!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="binding-stage-controls">
                    <button type="button" class="binding-stage-arrow" id="binding-stage-prev" aria-label="Show previous binding step">
                        ‚Üê
                    </button>
                    <div class="binding-stage-indicator" id="binding-stage-indicator">
                        Stage 1 of 4 ¬∑ Encryption Public Key
                    </div>
                    <button type="button" class="binding-stage-arrow" id="binding-stage-next" aria-label="Show next binding step">
                        ‚Üí
                    </button>
                </div>
                
                <!-- Verification Summary -->
                <div class="verification-status">
                    <div class="verify-box-v2 pending" id="binding-verify-box">
                        <div class="verify-icon-large" id="binding-verify-icon">‚è≥</div>
                        <h3 id="binding-verify-title">Awaiting Verification</h3>
                        <p class="verify-explanation" id="binding-verify-description">Once both parties sign each other's encryption public keys, we will run RSA-PSS verification to confirm authenticity.</p>
                    </div>
                </div>
                
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 3: File Encryption (AES-GCM) -->
            <section id="step-3" class="step-section">
                <div class="step-header">
                    <h2>Step 3: Encrypt File with AES-256-GCM</h2>
                    <p>Sender generates a random AES key and encrypts the file</p>
                </div>
                <div class="encryption-container">
                    <div class="encryption-flow-improved">
                        <!-- Original File Box -->
                        <div class="file-state">
                            <h3>üìÇ Original File</h3>
                            <div class="file-preview" id="original-file-preview">
                                <div class="file-icon-large">üìÑ</div>
                                <p class="file-name-large" id="selected-filename">Loading...</p>
                                <p class="file-size-large" id="selected-filesize">0 KB</p>
                            </div>
                        </div>
                        
                        <!-- Arrow Right -->
                        <div class="arrow-right-big">
                            <div class="arrow-label">ENCRYPT</div>
                            <div class="arrow-body">‚û°</div>
                        </div>
                        
                        <!-- Encryption Process Box -->
                        <div class="encryption-process-box">
                            <h3>üîê AES-256-GCM Encryption Process</h3>
                            <div class="process-steps-vertical">
                                <div class="process-step-inline">
                                    <span class="process-icon-small">üîë</span>
                                    <div class="process-info">
                                        <h4>1. Generate Random AES-256 Key</h4>
                                        <div class="aes-key-display" id="aes-key"></div>
                                    </div>
                                </div>
                                
                                <div class="arrow-down-inline">‚¨á</div>
                                
                                <div class="process-step-inline">
                                    <span class="process-icon-small">üé≤</span>
                                    <div class="process-info">
                                        <h4>2. Generate Random Nonce</h4>
                                        <div class="detail-text" id="nonce-display"></div>
                                    </div>
                                </div>
                                
                                <div class="arrow-down-inline">‚¨á</div>
                                
                                <div class="process-step-inline">
                                    <span class="process-icon-small">üìù</span>
                                    <div class="process-info">
                                        <h4>3. Add Metadata (AAD)</h4>
                                        <div class="detail-text" id="aad-display"></div>
                                    </div>
                                </div>
                                
                                <div class="arrow-down-inline">‚¨á</div>
                                
                                <div class="process-step-inline">
                                    <span class="process-icon-small">‚öôÔ∏è</span>
                                    <div class="process-info">
                                        <h4>4. Perform AES-GCM Encryption</h4>
                                        <div class="detail-text">Time: <span id="encrypt-time"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Arrow Right -->
                        <div class="arrow-right-big">
                            <div class="arrow-label">OUTPUT</div>
                            <div class="arrow-body">‚û°</div>
                        </div>
                        
                        <!-- Encrypted File Box -->
                        <div class="file-state">
                            <h3>üîí Encrypted File</h3>
                            <div class="file-preview encrypted" id="encrypted-file-preview">
                                <div class="ciphertext-display" id="ciphertext-preview"></div>
                                <p class="cipher-label">Ciphertext + Authentication Tag</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 4: Wrap AES Key (RSA-OAEP) -->
            <section id="step-4" class="step-section">
                <div class="step-header">
                    <h2>Step 4: Wrap AES Key with RSA-OAEP</h2>
                    <p>Encrypt the AES key using receiver's RSA public key so only they can decrypt</p>
                </div>
                <div class="key-wrap-container">
                    <div class="wrap-flow">
                        <div class="wrap-item">
                            <h3>AES Key (32 bytes)</h3>
                            <div class="key-box-display" id="aes-key-unwrapped"></div>
                        </div>
                        
                        <div class="wrap-process">
                            <div class="wrap-icon">üîí</div>
                            <p>RSA-OAEP Encryption</p>
                            <p class="wrap-detail">Using <span id="receiver-name">Receiver</span>'s Public Key</p>
                        </div>
                        
                        <div class="wrap-item">
                            <h3>Wrapped Key (256 bytes)</h3>
                            <div class="key-box-display wrapped" id="wrapped-key-display"></div>
                        </div>
                    </div>
                    <div class="wrap-info">
                        <p>‚úÖ Only <span id="receiver-name-2">receiver</span> with their private key can unwrap this key</p>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 5: Sign Envelope (RSA-PSS) -->
            <section id="step-5" class="step-section">
                <div class="step-header">
                    <h2>Step 5: Sign Envelope with RSA-PSS</h2>
                    <p>Sender signs the entire envelope to ensure authenticity and integrity</p>
                </div>
                <div class="signing-container">
                    <div class="envelope-display">
                        <h3>Envelope Contents</h3>
                        <div class="envelope-json" id="envelope-json"></div>
                    </div>
                    
                    <div class="signing-process">
                        <div class="sign-step">
                            <span class="sign-icon">üìù</span>
                            <h4>Hash Envelope (SHA-256)</h4>
                            <div class="hash-display" id="envelope-hash"></div>
                        </div>
                        <div class="process-arrow">‚Üì</div>
                        <div class="sign-step">
                            <span class="sign-icon">‚úçÔ∏è</span>
                            <h4>Sign with <span id="sender-name">Sender</span>'s Private Key</h4>
                            <div class="signature-display" id="envelope-signature"></div>
                        </div>
                    </div>
                    
                    <div class="signing-result">
                        <h3>‚úÖ Signed Envelope Ready for Transfer</h3>
                        <p>Contains: Wrapped Key + Ciphertext + Tag + Nonce + Metadata + Signature</p>
                        <button type="button" class="download-btn" id="download-envelope-btn">
                            ‚¨á Download Signed Envelope (JSON)
                        </button>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 6: Transfer with Attack Simulation -->
            <section id="step-6" class="step-section">
                <div class="step-header">
                    <h2>Step 6: Transfer Encrypted Envelope</h2>
                    <p>Watch the encrypted data travel from sender to receiver</p>
                </div>
                <div class="transfer-container">
                    <div class="transfer-visualization">
                        <div class="transfer-party sender" id="transfer-sender">
                            <img src="{{ url_for('static', filename='alice-image.jpg') }}" alt="Sender" class="transfer-avatar" id="sender-avatar">
                            <h3 id="sender-label">Alice</h3>
                            <div class="transfer-status">Sending...</div>
                        </div>
                        
                        <div class="transfer-path">
                            <div class="packet" id="transfer-packet">
                                <div class="packet-icon">üì¶</div>
                                <p>Encrypted Envelope</p>
                            </div>
                            <div class="path-line"></div>
                            <button class="intercept-btn" id="intercept-btn">
                                üî¥ INTERCEPT
                            </button>
                        </div>
                        
                        <div class="transfer-party receiver" id="transfer-receiver">
                            <img src="{{ url_for('static', filename='bob-image.jpg') }}" alt="Receiver" class="transfer-avatar" id="receiver-avatar">
                            <h3 id="receiver-label">Bob</h3>
                            <div class="transfer-status">Waiting...</div>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 7: Verify Signature -->
            <section id="step-7" class="step-section">
                <div class="step-header">
                    <h2>Step 7: Verify Digital Signature</h2>
                    <p>Receiver verifies the envelope's signature to confirm authenticity and integrity</p>
                </div>
                <div class="envelope-import">
                    <div>
                        <h3>Import Signed Envelope</h3>
                        <p>Upload a <code>.json</code> envelope to verify and decrypt it locally.</p>
                    </div>
                    <label class="import-btn">
                        ‚¨Ü Upload Envelope JSON
                        <input type="file" id="envelope-import-input" accept="application/json">
                    </label>
                    <p class="import-status" id="import-envelope-status">No envelope loaded</p>
                </div>
                <div class="verification-container">
                    <div class="verify-flow">
                        <div class="verify-step">
                            <h3>Received Envelope</h3>
                            <div class="envelope-box" id="received-envelope"></div>
                        </div>
                        
                        <div class="verify-process">
                            <div class="verify-action">
                                <span class="verify-icon">üîç</span>
                                <h4>Recreate Hash (SHA-256)</h4>
                                <div class="hash-display" id="verify-hash"></div>
                            </div>
                            <div class="process-arrow">‚Üì</div>
                            <div class="verify-action">
                                <span class="verify-icon">‚úì</span>
                                <h4>Verify with <span id="verify-sender-name">Sender</span>'s Public Key</h4>
                                <div class="verification-result" id="verification-result">
                                    <span class="verify-status">‚úÖ VERIFIED</span>
                                    <p>Signature is valid - envelope has not been tampered with</p>
                                    <p>Time: <span id="verify-time"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 8: Decrypt File -->
            <section id="step-8" class="step-section">
                <div class="step-header">
                    <h2>Step 8: Decrypt File</h2>
                    <p>Receiver unwraps the AES key and decrypts the file</p>
                </div>
                <div class="decryption-container">
                    <div class="decrypt-flow">
                        <div class="decrypt-step">
                            <h3>Step 1: Unwrap AES Key</h3>
                            <div class="unwrap-display">
                                <div class="key-box-display wrapped">
                                    <p>Wrapped Key</p>
                                    <div id="wrapped-key-decrypt"></div>
                                </div>
                                <span class="decrypt-arrow">‚Üí</span>
                                <div class="unwrap-process">
                                    <span class="process-icon">üîì</span>
                                    <p>RSA-OAEP Decrypt</p>
                                    <p class="detail">Using private key</p>
                                </div>
                                <span class="decrypt-arrow">‚Üí</span>
                                <div class="key-box-display">
                                    <p>AES Key</p>
                                    <div id="unwrapped-key"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="decrypt-step">
                            <h3>Step 2: Decrypt File with AES-GCM</h3>
                            <div class="aes-decrypt-display">
                                <div class="decrypt-inputs">
                                    <p><strong>Ciphertext:</strong> <span id="decrypt-ciphertext"></span></p>
                                    <p><strong>Nonce:</strong> <span id="decrypt-nonce"></span></p>
                                    <p><strong>Tag:</strong> <span id="decrypt-tag"></span></p>
                                </div>
                                <div class="decrypt-action">
                                    <span class="process-icon">üîê</span>
                                    <p>AES-256-GCM Decrypt</p>
                                    <p class="detail">Time: <span id="decrypt-time"></span></p>
                                </div>
                                <div class="decrypted-file">
                                    <h4>‚úÖ Decrypted File</h4>
                                    <div class="file-preview" id="decrypted-file-preview">
                                        <div class="file-icon-large">üìÑ</div>
                                        <p class="file-name-large" id="decrypted-filename"></p>
                                        <p class="file-size-large" id="decrypted-filesize"></p>
                                    </div>
                                    <button type="button" class="download-btn" id="download-decrypted-btn" disabled>
                                        ‚¨á Download Decrypted File
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue ‚Üí</button>
                </div>
            </section>

            <!-- Step 9: File Integrity Comparison -->
            <section id="step-9" class="step-section">
                <div class="step-header">
                    <h2>Step 9: Verify File Integrity</h2>
                    <p>Compare SHA-256 hashes to confirm bit-perfect transfer</p>
                </div>
                <div class="integrity-container">
                    <div class="hash-comparison">
                        <div class="hash-item">
                            <h3>Original File Hash</h3>
                            <div class="hash-display-large" id="original-hash"></div>
                        </div>
                        
                        <div class="comparison-arrow">
                            <span class="compare-icon">‚öñÔ∏è</span>
                        </div>
                        
                        <div class="hash-item">
                            <h3>Received File Hash</h3>
                            <div class="hash-display-large" id="received-hash"></div>
                        </div>
                    </div>
                    
                    <div class="integrity-result">
                        <div class="result-box success">
                            <span class="result-icon">‚úÖ</span>
                            <h3>PERFECT MATCH!</h3>
                            <p>File transferred securely with zero data loss</p>
                            <div class="metrics">
                                <div class="metric">
                                    <span class="metric-label">File Size:</span>
                                    <span class="metric-value" id="final-size"></span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Total Time:</span>
                                    <span class="metric-value" id="final-time"></span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Security:</span>
                                    <span class="metric-value">RSA-2048 + AES-256-GCM</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="attack-summary">
                        <h3>üõ°Ô∏è Attack Defense Summary</h3>
                        <div class="defense-list">
                            <div class="defense-item">
                                <span class="defense-icon">‚úÖ</span>
                                <p><strong>MITM Attack:</strong> Blocked by public key binding with digital signatures</p>
                            </div>
                            <div class="defense-item">
                                <span class="defense-icon">‚úÖ</span>
                                <p><strong>Replay Attack:</strong> Blocked by timestamp and nonce verification</p>
                            </div>
                            <div class="defense-item">
                                <span class="defense-icon">‚úÖ</span>
                                <p><strong>Tampering:</strong> Blocked by AES-GCM authentication tag</p>
                            </div>
                            <div class="defense-item">
                                <span class="defense-icon">‚úÖ</span>
                                <p><strong>Timing Attack:</strong> Blocked by constant-time operations</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="step-navigation">
                    <button class="back-btn" onclick="previousStep()">‚Üê Back</button>
                    <button class="restart-btn" onclick="restartDemo()">üîÑ Start New Transfer</button>
                </div>
            </section>

        </main>

        <!-- Progress Stepper -->
        <div class="progress-stepper">
            <div class="step" data-step="0">
                <span class="step-number">0</span>
                <span class="step-label">Setup</span>
            </div>
            <div class="step" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Generate Keys</span>
            </div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Exchange Keys</span>
            </div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Encrypt</span>
            </div>
            <div class="step" data-step="4">
                <span class="step-number">4</span>
                <span class="step-label">Wrap Key</span>
            </div>
            <div class="step" data-step="5">
                <span class="step-number">5</span>
                <span class="step-label">Sign</span>
            </div>
            <div class="step" data-step="6">
                <span class="step-number">6</span>
                <span class="step-label">Transfer</span>
            </div>
            <div class="step" data-step="7">
                <span class="step-number">7</span>
                <span class="step-label">Verify</span>
            </div>
            <div class="step" data-step="8">
                <span class="step-number">8</span>
                <span class="step-label">Decrypt</span>
            </div>
            <div class="step" data-step="9">
                <span class="step-number">9</span>
                <span class="step-label">Compare</span>
            </div>
        </div>

    </div>

    <!-- Intercept Modal -->
    <div id="intercept-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üî¥ PACKET INTERCEPTED</h2>
                <button class="close-modal" onclick="closeInterceptModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="intercepted-data">
                    <h3>Encrypted Envelope (Read-Only)</h3>
                    <div class="envelope-viewer" id="intercepted-envelope"></div>
                    <p class="info-text">The data is encrypted and cannot be read without the receiver's private key</p>
                </div>
                
                <div class="attack-simulator">
                    <h3>‚ö†Ô∏è Simulate Attacks</h3>
                    <p class="warning-text">Try to tamper with the encrypted data - all attacks will be detected and blocked!</p>
                    
                    <div class="attack-options">
                        <div class="attack-option">
                            <input type="checkbox" id="attack-tamper" class="attack-checkbox">
                            <label for="attack-tamper">
                                <h4>Tamper with Ciphertext</h4>
                                <p>Modify encrypted data to see authentication fail</p>
                            </label>
                        </div>
                        
                        <div class="attack-option">
                            <input type="checkbox" id="attack-replay" class="attack-checkbox">
                            <label for="attack-replay">
                                <h4>Replay Attack</h4>
                                <p>Try to resend old envelope (timestamp check)</p>
                            </label>
                        </div>
                        
                        <div class="attack-option">
                            <input type="checkbox" id="attack-mitm" class="attack-checkbox">
                            <label for="attack-mitm">
                                <h4>Man-in-the-Middle</h4>
                                <p>Attempt to swap public keys (signature fails)</p>
                            </label>
                        </div>
                        
                        <div class="attack-option">
                            <input type="checkbox" id="attack-timing" class="attack-checkbox">
                            <label for="attack-timing">
                                <h4>Timing Attack</h4>
                                <p>Try to measure verification time (constant-time)</p>
                            </label>
                        </div>
                    </div>
                    
                    <div class="attack-results" id="attack-results"></div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeInterceptModal()">Release Packet</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
